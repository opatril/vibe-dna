<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDNA - Anal√Ωza Genetick√Ωch Dat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        },
                        brand: {
                            light: '#34d399', // Emerald 400
                            DEFAULT: '#10b981', // Emerald 500
                            dark: '#059669', // Emerald 600
                            soft: 'rgba(16, 185, 129, 0.1)'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

        body {
            background: linear-gradient(135deg, #0a0118 0%, #1a0b2e 25%, #16213e 50%, #0f3460 75%, #1a1a2e 100%);
            background-attachment: fixed;
            color: #e2e8f0; /* Slate 200 */
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated gradient orbs for background */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 90% 10%, rgba(168, 85, 247, 0.1) 0%, transparent 50%);
            animation: gradientShift 20s ease infinite;
            z-index: -1;
            pointer-events: none;
        }

        @keyframes gradientShift {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(5%, 10%); }
            50% { transform: translate(10%, 5%); }
            75% { transform: translate(5%, -5%); }
        }

        /* === LAYOUT === */
        .app-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: rgba(15, 23, 42, 0.85); /* Semi-transparent Slate 900 */
            backdrop-filter: blur(12px);
            border-right: 1px solid rgba(51, 65, 85, 0.5); /* Slate 700 with opacity */
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 50;
            transition: transform 0.3s ease;
        }

        /* Subtle right-edge glow for sidebar */
        .sidebar::after {
            content: '';
            position: absolute;
            right: -100px;
            top: 0;
            width: 100px;
            height: 100%;
            background: linear-gradient(to right, 
                rgba(99, 102, 241, 0.1) 0%, 
                transparent 100%);
            filter: blur(30px);
            opacity: 0.6;
            pointer-events: none;
        }

        .main-content {
            margin-left: 260px;
            flex: 1;
            overflow-y: auto;
            height: 100vh;
            background: transparent;
            position: relative;
        }

        .content-wrapper {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* === SIDEBAR === */
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
            background: transparent;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.25rem;
            margin: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background-color: #334155;
            color: #f1f5f9;
        }

        .menu-item.active {
            background-color: rgba(16, 185, 129, 0.1); /* Emerald 500/10 */
            color: #34d399; /* Emerald 400 */
            font-weight: 600;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .sub-menu {
            margin-left: 1.75rem;
            border-left: 1px solid #334155;
            padding-left: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .sub-menu-item {
            padding: 0.5rem 0.75rem;
            margin: 0.125rem 0;
            border-radius: 0.375rem;
            cursor: pointer;
            color: #64748b;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .sub-menu-item:hover {
            color: #cbd5e1;
            background-color: #334155;
        }

        .sub-menu-item.active {
            color: #34d399;
            background-color: rgba(16, 185, 129, 0.1);
            font-weight: 500;
        }

        /* === CARDS & SECTIONS === */
        .category-section {
            margin-bottom: 3rem;
            position: relative;
        }

        /* The visual connector line for the section */
        .category-connector {
            position: absolute;
            left: 24px;
            top: 80px;
            bottom: 0;
            width: 2px;
            background: #334155;
            z-index: 0;
        }

        .category-header {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid rgba(51, 65, 85, 0.5);
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        /* Glow effect for category headers */
        .category-header::after {
            content: '';
            position: absolute;
            bottom: -80px;
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            height: 100px;
            background: radial-gradient(ellipse at center, 
                rgba(99, 102, 241, 0.2) 0%, 
                rgba(16, 185, 129, 0.15) 30%, 
                transparent 70%);
            filter: blur(50px);
            opacity: 0.5;
            z-index: -1;
            pointer-events: none;
        }

        .category-icon-box {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            font-size: 1.5rem;
            border-radius: 0.75rem;
            flex-shrink: 0;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.3),
                        inset 0 0 20px rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            animation: iconPulse 3s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(16, 185, 129, 0.3), inset 0 0 20px rgba(16, 185, 129, 0.1); }
            50% { box-shadow: 0 0 40px rgba(16, 185, 129, 0.5), inset 0 0 30px rgba(16, 185, 129, 0.2); }
        }

        .trait-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            margin-left: 24px; /* Indent for connector */
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* GitHub Copilot-style glow effect */
        .trait-card::after {
            content: '';
            position: absolute;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 120px;
            background: radial-gradient(ellipse at center, 
                rgba(16, 185, 129, 0.15) 0%, 
                rgba(99, 102, 241, 0.1) 30%, 
                transparent 70%);
            filter: blur(40px);
            opacity: 0.6;
            z-index: -1;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        /* Connector dot */
        .trait-card::before {
            content: '';
            position: absolute;
            left: -25px;
            top: 40px;
            width: 12px;
            height: 12px;
            background: #1e293b;
            border: 2px solid #475569;
            border-radius: 50%;
            z-index: 2;
        }

        .trait-card:hover {
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3);
            border-color: rgba(16, 185, 129, 0.6);
        }

        .trait-card:hover::before {
            border-color: #34d399;
            background: #34d399;
        }

        .trait-card:hover::after {
            opacity: 1;
            height: 140px;
        }

        .trait-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #334155;
        }

        .trait-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* === SNP VISUALIZATION === */
        .snp-container {
            background: rgba(15, 23, 42, 0.6); /* Darker inner bg with opacity */
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-top: 1rem;
            position: relative;
            overflow: visible;
        }

        /* Subtle glow for SNP containers */
        .snp-container::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 0.75rem;
            padding: 1px;
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.1) 0%, 
                rgba(99, 102, 241, 0.1) 50%, 
                rgba(168, 85, 247, 0.1) 100%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .trait-card:hover .snp-container::before {
            opacity: 1;
        }

        .snp-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .gene-badge {
            background: rgba(51, 65, 85, 0.8);
            color: #e2e8f0;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
        }

        .rsid-link {
            color: #64748b;
            text-decoration: none;
        }
        .rsid-link:hover {
            color: #34d399;
            text-decoration: underline;
        }

        /* The Variant Spectrum */
        .variant-spectrum {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .variant-box {
            flex: 1;
            border: 1px solid rgba(51, 65, 85, 0.5);
            background: rgba(30, 41, 59, 0.4);
            border-radius: 0.5rem;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0.5;
            transition: all 0.2s;
            min-width: 60px;
        }

        .variant-box.active {
            opacity: 1;
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        .variant-genotype {
            font-size: 1.1rem;
            font-weight: 700;
            color: #94a3b8;
            margin-bottom: 0.25rem;
        }

        .variant-box.active .variant-genotype {
            color: #34d399;
        }

        .variant-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
        }
        
        .variant-box.active .variant-label {
            color: #6ee7b7;
            font-weight: 600;
        }

        /* Result Explanation */
        .result-explanation {
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.4);
            border-left: 4px solid #10b981;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        .result-text {
            font-size: 0.95rem;
            color: #e2e8f0;
            line-height: 1.6;
        }
        
        .result-text b {
            color: #34d399;
        }

        /* Stats Bar */
        .stats-bar {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 40;
            display: flex;
            gap: 2rem;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Subtle top glow for stats bar */
        .stats-bar::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 80px;
            background: radial-gradient(ellipse at center, 
                rgba(16, 185, 129, 0.15) 0%, 
                rgba(99, 102, 241, 0.1) 40%, 
                transparent 70%);
            filter: blur(40px);
            opacity: 0.5;
            z-index: -1;
            pointer-events: none;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f1f5f9;
            display: block;
            text-align: center;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-align: center;
            display: block;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.mobile-open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .trait-card { margin-left: 0; }
            .category-connector { display: none; }
            .variant-spectrum { flex-wrap: wrap; }
            .stats-bar { flex-wrap: wrap; padding: 1rem; }
        }
        
        /* Utils */
        .hidden { display: none !important; }
        .score-badge {
            padding: 0.35rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            transition: all 0.3s ease;
        }
        .score-excellent { 
            background: rgba(34, 197, 94, 0.2); 
            color: #4ade80; 
            border: 1px solid rgba(34, 197, 94, 0.3);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }
        .score-good { 
            background: rgba(59, 130, 246, 0.2); 
            color: #60a5fa; 
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }
        .score-average { 
            background: rgba(234, 179, 8, 0.2); 
            color: #facc15; 
            border: 1px solid rgba(234, 179, 8, 0.3);
            box-shadow: 0 0 20px rgba(234, 179, 8, 0.2);
        }
        .score-poor { 
            background: rgba(239, 68, 68, 0.2); 
            color: #f87171; 
            border: 1px solid rgba(239, 68, 68, 0.3);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }
        .score-risk { 
            background: rgba(239, 68, 68, 0.2); 
            color: #f87171; 
            border: 1px solid rgba(239, 68, 68, 0.3);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .drop-zone {
            border: 2px dashed #475569;
            border-radius: 1rem;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.02);
            position: relative;
            overflow: hidden;
        }
        
        .drop-zone::before {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 1rem;
            padding: 2px;
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.3) 0%, 
                rgba(99, 102, 241, 0.3) 50%, 
                rgba(168, 85, 247, 0.3) 100%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            animation: borderFlow 3s linear infinite;
        }

        @keyframes borderFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .drop-zone:hover::before, .drop-zone.drag-over::before {
            opacity: 1;
        }
        
        .drop-zone:hover, .drop-zone.drag-over {
            border-color: transparent;
            background: rgba(16, 185, 129, 0.1);
            box-shadow: 0 0 40px rgba(16, 185, 129, 0.3), 
                        0 0 80px rgba(99, 102, 241, 0.2);
        }

        .evidence-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 0.25rem;
            background: rgba(51, 65, 85, 0.8);
            color: #cbd5e1;
        }
        
        .evidence-high, .evidence-strong { color: #4ade80; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.2); }
        .evidence-moderate { color: #facc15; background: rgba(234, 179, 8, 0.1); border: 1px solid rgba(234, 179, 8, 0.2); }
        .evidence-low, .evidence-emerging { color: #fb923c; background: rgba(249, 115, 22, 0.1); border: 1px solid rgba(249, 115, 22, 0.2); }
        
        .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(51, 65, 85, 0.5);
            position: relative;
        }

        /* Glow effect for glass panels */
        .glass-panel::after {
            content: '';
            position: absolute;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 120px;
            background: radial-gradient(ellipse at center, 
                rgba(99, 102, 241, 0.2) 0%, 
                rgba(168, 85, 247, 0.15) 30%, 
                transparent 70%);
            filter: blur(60px);
            opacity: 0.7;
            z-index: -1;
            pointer-events: none;
        }

        /* ===================== PRINT STYLES ===================== */
        @media print {
            /* Reset body and hide animations */
            body {
                background: white !important;
                color: black !important;
                margin: 0;
                padding: 0;
            }
            
            body::before {
                display: none !important;
            }

            /* Hide sidebar and mobile menu */
            .sidebar,
            #mobile-menu-toggle {
                display: none !important;
            }

            /* Reset main content layout */
            .main-content {
                margin-left: 0 !important;
                width: 100% !important;
                height: auto !important;
                overflow: visible !important;
            }

            /* Hide upload sections */
            #db-upload-section,
            #csv-upload-section {
                display: none !important;
            }

            /* Show results section */
            #results-section {
                display: block !important;
            }

            /* Fix stats bar */
            .stats-bar {
                position: static !important;
                background: #f8fafc !important;
                border: 2px solid #334155 !important;
                border-radius: 8px !important;
                padding: 15px !important;
                margin-bottom: 20px !important;
                page-break-inside: avoid;
            }

            .stats-bar::before {
                display: none !important;
            }

            /* Hide comparison and export buttons */
            #comparison-container,
            #export-pdf-btn {
                display: none !important;
            }

            .stat-value {
                color: #1e293b !important;
                font-size: 18px !important;
            }

            .stat-label {
                color: #475569 !important;
            }

            /* Content wrapper */
            .content-wrapper {
                max-width: 100% !important;
                padding: 0 20px !important;
            }

            /* Category sections */
            .category-section {
                page-break-inside: avoid;
                margin-bottom: 30px !important;
            }

            .category-connector {
                display: none !important;
            }

            .category-header {
                background: #f1f5f9 !important;
                border: 2px solid #334155 !important;
                border-radius: 8px !important;
                padding: 15px !important;
                margin-bottom: 15px !important;
                page-break-inside: avoid;
                page-break-after: avoid;
            }

            .category-header::after {
                display: none !important;
            }

            .category-header h2 {
                color: #1e293b !important;
            }

            .category-header p {
                color: #475569 !important;
            }

            .category-icon-box {
                background: #e2e8f0 !important;
                border: 2px solid #64748b !important;
                box-shadow: none !important;
                animation: none !important;
            }

            /* Trait cards */
            .trait-card {
                background: white !important;
                border: 2px solid #cbd5e1 !important;
                border-radius: 8px !important;
                padding: 15px !important;
                margin-bottom: 15px !important;
                margin-left: 0 !important;
                page-break-inside: avoid;
                box-shadow: none !important;
            }

            .trait-card::before,
            .trait-card::after {
                display: none !important;
            }

            .trait-title {
                color: #1e293b !important;
            }

            .evidence-badge {
                border: 1px solid #64748b !important;
                background: #f1f5f9 !important;
                color: #475569 !important;
            }

            /* Score badges */
            .score-badge {
                border: 2px solid !important;
                box-shadow: none !important;
                background: white !important;
            }

            .score-excellent {
                border-color: #22c55e !important;
                color: #15803d !important;
            }

            .score-good {
                border-color: #3b82f6 !important;
                color: #1e40af !important;
            }

            .score-average {
                border-color: #eab308 !important;
                color: #a16207 !important;
            }

            .score-poor,
            .score-risk {
                border-color: #ef4444 !important;
                color: #b91c1c !important;
            }

            /* SNP containers */
            .snp-container {
                background: #f8fafc !important;
                border: 1px solid #cbd5e1 !important;
                padding: 10px !important;
                margin-top: 10px !important;
                page-break-inside: avoid;
            }

            .snp-container::before {
                display: none !important;
            }

            .snp-meta {
                color: #475569 !important;
            }

            .gene-badge {
                background: #e2e8f0 !important;
                color: #1e293b !important;
                border: 1px solid #94a3b8 !important;
            }

            .rsid-link {
                color: #475569 !important;
            }

            /* Variant boxes */
            .variant-box {
                border: 2px solid #cbd5e1 !important;
                background: white !important;
            }

            .variant-box.active {
                border-color: #10b981 !important;
                background: #d1fae5 !important;
            }

            .variant-genotype {
                color: #1e293b !important;
            }

            .variant-box.active .variant-genotype {
                color: #047857 !important;
            }

            .variant-label {
                color: #64748b !important;
            }

            .variant-box.active .variant-label {
                color: #059669 !important;
            }

            /* Result explanation */
            .result-explanation {
                background: #f8fafc !important;
                border-left: 4px solid #10b981 !important;
            }

            .result-text {
                color: #334155 !important;
            }

            .result-text b {
                color: #047857 !important;
            }

            /* Remove all animations */
            * {
                animation: none !important;
                transition: none !important;
            }

            /* Page breaks */
            .category-section {
                page-break-before: auto;
            }

            h1, h2, h3, h4 {
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>

    <!-- Mobile Menu Toggle -->
    <div class="fixed bottom-4 right-4 bg-brand text-white p-4 rounded-full shadow-xl z-50 cursor-pointer md:hidden" id="mobile-menu-toggle">
        ‚ò∞
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="text-xl font-bold text-slate-100 flex items-center gap-2">
                    üß¨ MyDNA <span class="text-xs font-normal text-slate-400 bg-slate-800 border border-slate-600 px-2 py-0.5 rounded">v2.0</span>
                </div>
            </div>
            <div class="sidebar-menu py-4" id="sidebar-menu">
                <!-- Menu populated via JS -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Database Upload Section -->
            <div id="db-upload-section" class="content-wrapper pt-20 flex flex-col items-center justify-center min-h-screen">
                <div class="text-center mb-10">
                    <div class="text-6xl mb-4">üß¨</div>
                    <h1 class="text-3xl font-bold text-slate-100 mb-2">V√≠tejte v MyDNA</h1>
                    <p class="text-slate-400">Nahrajte datab√°zi pro zah√°jen√≠ anal√Ωzy</p>
                </div>

                <div class="glass-panel p-8 rounded-2xl shadow-sm w-full max-w-md">
                    <div id="db-status-message" class="mb-6 p-4 bg-slate-900/50 rounded-lg border border-slate-700/50 text-sm">
                        <p class="font-semibold text-slate-300">Naƒç√≠t√°n√≠ syst√©mu...</p>
                    </div>

                    <div id="drop-zone-db" class="drop-zone hidden p-8 text-center cursor-pointer">
                        <div class="text-3xl mb-2">üìÅ</div>
                        <div class="font-medium text-slate-300">Nahr√°t snp_database.json</div>
                        <input type="file" id="file-input-db" accept=".json" class="hidden">
                    </div>
                </div>
            </div>

            <!-- CSV Upload Section -->
            <div id="csv-upload-section" class="hidden content-wrapper pt-20 flex flex-col items-center justify-center min-h-[80vh]">
                <div class="text-center mb-10">
                    <h1 class="text-3xl font-bold text-slate-100 mb-2">Anal√Ωza DNA</h1>
                    <p class="text-slate-400">Nahrajte sv≈Øj raw data soubor (CSV/TXT)</p>
                </div>

                <div class="glass-panel p-10 rounded-2xl shadow-sm w-full max-w-2xl">
                    <div id="drop-zone" class="drop-zone p-12 text-center cursor-pointer">
                        <div class="text-5xl mb-4">üß¨</div>
                        <div class="text-xl font-semibold text-slate-100 mb-2">P≈ôet√°hnƒõte soubor sem</div>
                        <div class="text-slate-400 text-sm mb-6">Podpora pro FTDNA, 23andMe, Ancestry</div>
                        <button class="bg-emerald-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-emerald-700 transition">Vybrat soubor</button>
                        <input type="file" id="file-input" accept=".csv,.txt" class="hidden">
                    </div>

                    <div id="processing" class="hidden mt-8">
                        <div class="text-center mb-2 text-sm font-medium text-slate-400" id="progress-text">Zpracov√°n√≠...</div>
                        <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                            <div id="progress-bar" class="h-full bg-emerald-500 transition-all duration-300" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="results-section" class="hidden">
                <!-- Stats Header -->
                <div class="stats-bar">
                    <div>
                        <span class="stat-value" id="total-markers">-</span>
                        <span class="stat-label">Marker≈Ø</span>
                    </div>
                    <div>
                        <span class="stat-value" id="found-markers">-</span>
                        <span class="stat-label">Analyzov√°no</span>
                    </div>
                    <div>
                        <span class="stat-value text-emerald-400" id="match-percent">-</span>
                        <span class="stat-label">Nalezeno</span>
                    </div>
                    
                    <!-- Comparison Upload -->
                    <div class="ml-4 pl-4 border-l border-slate-700 flex items-center" id="comparison-container">
                        <div id="comparison-drop-zone" class="border border-dashed border-slate-600 hover:border-emerald-500 hover:bg-slate-800/50 rounded-lg p-2 px-4 cursor-pointer transition flex items-center gap-3 group">
                            <div class="text-2xl group-hover:scale-110 transition-transform">‚öñÔ∏è</div>
                            <div class="text-left">
                                <div class="text-xs font-bold text-slate-300 group-hover:text-emerald-400">POROVNAT S DRUH√ùM</div>
                                <div class="text-[10px] text-slate-500">P≈ôet√°hnƒõte soubor sem</div>
                            </div>
                        </div>
                        <input type="file" id="file-input-comparison" accept=".csv,.txt" class="hidden">
                    </div>

                    <!-- Screenshot Export -->
                    <div class="ml-4 pl-4 border-l border-slate-700 flex items-center">
                        <button id="export-pdf-btn" onclick="exportPDF()" class="bg-slate-800 hover:bg-slate-700 border border-slate-600 text-slate-300 hover:text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 transition text-sm group">
                            <span class="group-hover:scale-110 transition-transform">üì∏</span> St√°hnout Screenshot
                        </button>
                    </div>
                </div>

                <div class="content-wrapper py-8" id="results-container">
                    <!-- Results injected here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        // =====================================================
        // GLOBAL STATE
        // =====================================================
        let SNP_DATABASE = null;
        let userData = null;
        let userDataB = null;
        let userResults = {};
        let userResultsB = {};
        let comparisonMode = false;

        const SCORE_POINTS = { 
            'excellent': 2, 
            'good': 1, 
            'average': 0, 
            'neutral': 1, 
            'poor': 0, 
            'risk': 0,
            'caution': 0
        };
        const EVIDENCE_WEIGHT = { 'high': 1.0, 'strong': 1.0, 'moderate': 0.7, 'low': 0.4, 'emerging': 0.25 };

        // =====================================================
        // UTILS
        // =====================================================
        function normalizeRsid(rsid) {
            return String(rsid).trim().toLowerCase();
        }

        function normalizeGenotype(gt) {
            if (!gt) return "";
            const clean = String(gt).toUpperCase().replace(/[^ACGT]/g, "");
            if (clean.length !== 2) return clean;
            return clean.split("").sort().join("");
        }

        function reverseComplement(genotype) {
            if (!genotype) return "";
            const complement = { 'A': 'T', 'T': 'A', 'C': 'G', 'G': 'C' };
            return genotype.split('').map(base => complement[base] || base).join('').split('').sort().join('');
        }

        // =====================================================
        // DATABASE & FILE HANDLING
        // =====================================================
        async function loadDatabaseFromGitHub() {
            const statusMessage = document.getElementById('db-status-message');
            try {
                const response = await fetch('https://raw.githubusercontent.com/marekopatril/vibe-dna/refs/heads/main/snp_database.json');
                if (!response.ok) throw new Error("Network response was not ok");
                const json = await response.json();
                SNP_DATABASE = json;
                
                statusMessage.innerHTML = '<span class="text-emerald-600 font-semibold">‚úì Datab√°ze p≈ôipravena</span>';
                setTimeout(() => {
                    document.getElementById('db-upload-section').classList.add('hidden');
                    document.getElementById('csv-upload-section').classList.remove('hidden');
                    buildSidebar();
                }, 1000);
            } catch (error) {
                statusMessage.innerHTML = '<span class="text-amber-600">‚ö† Automatick√© sta≈æen√≠ selhalo. Nahrajte soubor ruƒçnƒõ.</span>';
                document.getElementById('drop-zone-db').classList.remove('hidden');
            }
        }

        function handleDbFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    SNP_DATABASE = JSON.parse(e.target.result);
                    document.getElementById('db-upload-section').classList.add('hidden');
                    document.getElementById('csv-upload-section').classList.remove('hidden');
                    buildSidebar();
                } catch (err) { alert("Chyba JSON: " + err.message); }
            };
            reader.readAsText(file);
        }

        function parseFTDNACsv(text, onProgress) {
            const lines = text.split(/\r?\n/);
            const map = new Map();
            const total = lines.length;
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                if (!line || line.startsWith("#")) continue;
                let parts = line.includes(",") ? line.split(",") : line.split(/\t+/);
                if (parts[0]?.toUpperCase() === "RSID" || parts.length < 4) continue;

                const rsid = normalizeRsid(parts[0]);
                const result = normalizeGenotype(parts[3]);
                if (rsid && result) map.set(rsid, result);
                
                if (onProgress && i % 5000 === 0) onProgress(Math.round((i / total) * 100));
            }
            if (onProgress) onProgress(100);
            return map;
        }

        function handleCsvFile(file, isComparison = false) {
            if (!SNP_DATABASE) return alert('Chyb√≠ datab√°ze!');
            
            if (!isComparison) {
                document.getElementById('processing').classList.remove('hidden');
            } else {
                // Visual feedback for comparison upload
                const zone = document.getElementById('comparison-drop-zone');
                const originalContent = zone.innerHTML;
                zone.innerHTML = `
                    <div class="animate-spin h-5 w-5 border-2 border-emerald-500 border-t-transparent rounded-full mr-2"></div>
                    <span class="text-xs font-bold text-slate-300">Naƒç√≠t√°m...</span>
                `;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const parsed = parseFTDNACsv(e.target.result, (p) => {
                    if (!isComparison) {
                        document.getElementById('progress-bar').style.width = p + '%';
                        document.getElementById('progress-text').innerText = `Anal√Ωza... ${p}%`;
                    }
                });
                
                if (isComparison) {
                    userDataB = parsed;
                    comparisonMode = true;
                    
                    // Update Drop Zone to show loaded state
                    const zone = document.getElementById('comparison-drop-zone');
                    zone.innerHTML = `
                        <div class="text-emerald-400 text-xl">‚úì</div>
                        <div class="text-left flex-1 min-w-0 ml-2">
                            <div class="text-xs font-bold text-emerald-400">TEST B NAƒåTEN</div>
                            <div class="text-[10px] text-slate-500 truncate" title="${file.name}">${file.name}</div>
                        </div>
                        <div onclick="removeComparison(event)" class="ml-2 p-1.5 hover:bg-red-500/20 text-slate-500 hover:text-red-400 rounded-full transition z-10" title="Zru≈°it">
                            ‚úï
                        </div>
                    `;
                    zone.classList.add('border-emerald-500/50', 'bg-emerald-500/5');
                    
                    // Re-run analysis with comparison data
                    analyzeGenetics();
                    renderResults(); 
                    
                    // Re-initialize scroll spy
                    setTimeout(() => initScrollSpy(), 100);
                } else {
                    userData = parsed;
                    analyzeGenetics();
                    setTimeout(() => {
                        document.getElementById('csv-upload-section').classList.add('hidden');
                        document.getElementById('results-section').classList.remove('hidden');
                        renderResults();
                        initScrollSpy();
                    }, 500);
                }
            };
            reader.readAsText(file);
        }

        function removeComparison(e) {
            if (e) e.stopPropagation();
            
            userDataB = null;
            userResultsB = {};
            comparisonMode = false;
            
            // Reset UI
            const zone = document.getElementById('comparison-drop-zone');
            zone.classList.remove('border-emerald-500/50', 'bg-emerald-500/5');
            zone.innerHTML = `
                <div class="text-2xl group-hover:scale-110 transition-transform">‚öñÔ∏è</div>
                <div class="text-left">
                    <div class="text-xs font-bold text-slate-300 group-hover:text-emerald-400">POROVNAT S DRUH√ùM</div>
                    <div class="text-[10px] text-slate-500">P≈ôet√°hnƒõte soubor sem</div>
                </div>
            `;
            
            // Clear file input
            document.getElementById('file-input-comparison').value = '';

            // Re-render
            analyzeGenetics();
            renderResults();
            setTimeout(() => initScrollSpy(), 100);
        }

        // =====================================================
        // CORE LOGIC
        // =====================================================
        
        function getAlleleEntry(snpObj, userGt) {
            if (!snpObj || !snpObj.alleles) return null;
            const ngt = normalizeGenotype(userGt);
            
            // Direct match
            for (const [key, val] of Object.entries(snpObj.alleles)) {
                if (normalizeGenotype(key) === ngt) {
                    return { ...val, matchedKey: key, isReverseComplement: false };
                }
            }

            // Reverse Complement
            const revComp = reverseComplement(ngt);
            for (const [key, val] of Object.entries(snpObj.alleles)) {
                if (normalizeGenotype(key) === revComp) {
                    return { ...val, matchedKey: key, isReverseComplement: true };
                }
            }
            return null;
        }

        function computeTraitScore(trait, snpsMap) {
            const snps = trait.snps || {};
            const perSnp = [];
            let found = 0, obtained = 0, maxPossible = 0;
            
            // Simplified weight logic for brevity
            const weights = Object.keys(snps).map(rsid => ({
                rsid: normalizeRsid(rsid),
                weight: EVIDENCE_WEIGHT[snps[rsid].evidence || "moderate"] || 0.7
            }));

            for (const w of weights) {
                const snpObj = snps[w.rsid];
                const gt = snpsMap?.get(w.rsid);
                maxPossible += w.weight * 2;

                if (gt) {
                    found++;
                    const allele = getAlleleEntry(snpObj, gt);
                    const score = allele?.score || "average";
                    obtained += w.weight * (SCORE_POINTS[score] ?? 0);

                    perSnp.push({
                        rsid: w.rsid,
                        gene: snpObj.gene || "",
                        genotype: gt,
                        score: score,
                        description: allele?.description,
                        matchedKey: allele?.matchedKey,
                        isReverseComplement: allele?.isReverseComplement || false,
                        allAlleles: snpObj.alleles // IMPORTANT: Passing full alleles for rendering
                    });
                } else {
                    perSnp.push({
                        rsid: w.rsid,
                        gene: snpObj.gene || "",
                        genotype: null,
                        allAlleles: snpObj.alleles // Also pass for missing items
                    });
                }
            }

            const combinedPercent = maxPossible > 0 ? Math.round((obtained / maxPossible) * 100) : 0;
            let overallScore = 'average';
            if (combinedPercent >= 75) overallScore = 'excellent';
            else if (combinedPercent >= 50) overallScore = 'good';
            else if (combinedPercent >= 25) overallScore = 'average';
            else overallScore = 'poor';

            return { 
                overallScore, combinedPercent, found, total: weights.length, perSnp,
                coveragePercent: weights.length ? Math.round((found/weights.length)*100) : 0
            };
        }

        function analyzeGenetics() {
            userResults = {};
            userResultsB = {};
            let totalSearched = 0, totalFound = 0;

            for (const [catId, cat] of Object.entries(SNP_DATABASE)) {
                userResults[catId] = {};
                if (comparisonMode) userResultsB[catId] = {};

                for (const [traitId, trait] of Object.entries(cat.traits)) {
                    const res = computeTraitScore(trait, userData);
                    
                    // Always count searched SNPs
                    totalSearched += res.total;

                    if (res.found > 0) {
                        userResults[catId][traitId] = { ...trait, ...res };
                        totalFound += res.found;
                    }
                    
                    if (comparisonMode && userDataB) {
                        const resB = computeTraitScore(trait, userDataB);
                        if (resB.found > 0) {
                            userResultsB[catId][traitId] = { ...trait, ...resB };
                        }
                    }
                }
            }
            
            document.getElementById('total-markers').textContent = userData.size.toLocaleString();
            document.getElementById('found-markers').textContent = totalSearched.toLocaleString();
            document.getElementById('match-percent').textContent = totalFound.toLocaleString();
        }

        // =====================================================
        // RENDERING
        // =====================================================

        function buildSidebar() {
            const menu = document.getElementById('sidebar-menu');
            menu.innerHTML = '';
            
            for (const [catId, cat] of Object.entries(SNP_DATABASE)) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="menu-item" onclick="scrollToId('category-${catId}')">
                        <span class="mr-2">${cat.icon}</span> ${cat.name}
                    </div>
                    <div class="sub-menu">
                        ${Object.entries(cat.traits).map(([tId, t]) => `
                            <div class="sub-menu-item" onclick="scrollToId('trait-${catId}-${tId}')">
                                ${t.name}
                            </div>
                        `).join('')}
                    </div>
                `;
                menu.appendChild(div);
            }
        }

        function scrollToId(id) {
            document.getElementById(id)?.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Close mobile menu
            document.getElementById('sidebar').classList.remove('mobile-open');
        }

        function renderResults() {
            const container = document.getElementById('results-container');
            container.innerHTML = '';

            for (const [catId, catResults] of Object.entries(userResults)) {
                if (Object.keys(catResults).length === 0) continue;
                
                const catDef = SNP_DATABASE[catId];
                const section = document.createElement('div');
                section.className = 'category-section';
                section.id = `category-${catId}`;
                
                section.innerHTML = `
                    <div class="category-connector"></div>
                    <div class="category-header">
                        <div class="category-icon-box">${catDef.icon}</div>
                        <div>
                            <h2 class="text-2xl font-bold text-slate-200">${catDef.name}</h2>
                            <p class="text-slate-400">${catDef.description}</p>
                        </div>
                    </div>
                    <div id="traits-${catId}"></div>
                `;
                
                container.appendChild(section);
                const traitContainer = section.querySelector(`#traits-${catId}`);

                for (const [traitId, trait] of Object.entries(catResults)) {
                    const traitB = (comparisonMode && userResultsB[catId]) ? userResultsB[catId][traitId] : null;
                    traitContainer.appendChild(createTraitCard(trait, catId, traitId, traitB));
                }
            }
        }

        function createTraitCard(trait, catId, traitId, traitB = null) {
            const card = document.createElement('div');
            card.className = 'trait-card';
            card.id = `trait-${catId}-${traitId}`;

            const scoreLabels = { 
                'excellent': 'V√Ωborn√Ω', 
                'good': 'Dobr√Ω', 
                'average': 'Pr≈Ømƒõrn√Ω', 
                'poor': 'Slab√Ω',
                'risk': 'Riziko',
                'caution': 'Pozor'
            };
            
            const evidenceLabels = {
                'high': 'Vysok√° m√≠ra d≈Økaz≈Ø',
                'strong': 'Vysok√° m√≠ra d≈Økaz≈Ø',
                'moderate': 'St≈ôedn√≠ m√≠ra d≈Økaz≈Ø',
                'low': 'N√≠zk√° m√≠ra d≈Økaz≈Ø',
                'emerging': 'Nov√Ω v√Ωzkum'
            };
            
            const evidence = trait.evidence || 'moderate';

            // Updated Header for Comparison Support
            let headerScoresHtml = '';
            
            if (comparisonMode && traitB) {
                // Comparison mode: Scores are shown in the columns below (always visible)
                headerScoresHtml = '';
            } else {
                // Single mode: normal display
                headerScoresHtml = `
                    <div class="flex flex-col items-end">
                        <div class="score-badge score-${trait.overallScore}">
                            ${scoreLabels[trait.overallScore]} (${trait.combinedPercent}%)
                        </div>
                    </div>
                `;
            }

            let cardContent = `
                <div class="trait-header-row">
                    <div class="trait-title">
                        <span class="text-2xl">${trait.icon}</span>
                        <div>
                            ${trait.name}
                            <div class="evidence-badge evidence-${evidence} inline-block ml-2 font-normal">
                                ${evidenceLabels[evidence]}
                            </div>
                        </div>
                    </div>
                    ${headerScoresHtml}
                </div>
            `;

            if (comparisonMode && traitB) {
                // SIDE BY SIDE LAYOUT - INTERLEAVED ROW BY ROW
                
                // Column Headers (Responsive - Always Visible)
                cardContent += `
                    <div class="flex flex-col lg:grid lg:grid-cols-2 gap-4 lg:gap-8 mb-6 relative border-b border-slate-700 pb-4">
                        <div class="absolute left-1/2 top-0 bottom-0 w-px bg-slate-700 hidden lg:block"></div>
                        
                        <!-- Test A Header -->
                        <div class="text-center flex flex-col items-center gap-2 py-2">
                            <span class="px-3 py-1 bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 rounded-full text-xs font-bold uppercase tracking-wide">Test A</span>
                            <div class="score-badge score-${trait.overallScore}">
                                ${scoreLabels[trait.overallScore]} (${trait.combinedPercent}%)
                            </div>
                        </div>

                        <!-- Test B Header -->
                        <div class="text-center flex flex-col items-center gap-2 py-2 border-t border-slate-800/50 lg:border-t-0 pt-4 lg:pt-2">
                            <span class="px-3 py-1 bg-sky-500/20 text-sky-400 border border-sky-500/30 rounded-full text-xs font-bold uppercase tracking-wide">Test B</span>
                            <div class="score-badge score-${traitB.overallScore}">
                                ${scoreLabels[traitB.overallScore]} (${traitB.combinedPercent}%)
                            </div>
                        </div>
                    </div>
                `;

                // SNP Rows
                trait.perSnp.forEach((snpA, i) => {
                    const snpB = traitB.perSnp[i];
                    cardContent += `
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6 relative group">
                            <div class="absolute left-1/2 top-0 bottom-0 w-px bg-slate-700 hidden lg:block"></div>
                            
                            <!-- Test A -->
                            <div class="flex flex-col">
                                <div class="lg:hidden text-center mb-2"><span class="text-xs font-bold text-emerald-400">Test A</span></div>
                                <div class="h-full">
                                    ${renderSnpCard(snpA, "Test A", true)}
                                </div>
                            </div>

                            <!-- Test B -->
                            <div class="flex flex-col">
                                <div class="lg:hidden text-center mb-2 mt-4 pt-4 border-t border-slate-800"><span class="text-xs font-bold text-sky-400">Test B</span></div>
                                <div class="h-full">
                                    ${renderSnpCard(snpB, "Test B", true)}
                                </div>
                            </div>
                        </div>
                    `;
                });

            } else {
                // SINGLE LAYOUT
                cardContent += `
                    <div class="mb-6">
                        ${createSnpsHtml(trait.perSnp)}
                    </div>
                `;
            }

            // Recommendations (Shared) - Only show in single mode
            if (!comparisonMode && trait.recommendations) {
                cardContent += `
                <div class="bg-slate-800/40 p-4 rounded-lg border border-slate-700/50 mt-4">
                    <h4 class="font-semibold text-emerald-400 mb-2 flex items-center gap-2">üí° Doporuƒçen√≠</h4>
                    <ul class="list-disc list-inside text-sm text-slate-300 space-y-1">
                        ${trait.recommendations.map(r => `<li>${r}</li>`).join('')}
                    </ul>
                </div>`;
            }

            card.innerHTML = cardContent;
            return card;
        }

        function renderSnpCard(snp, userLabel, isCompact) {
            if (!snp.genotype) return ''; // Skip missing

            // Get user's allele data
            const userAlleleKey = snp.matchedKey || snp.genotype;
            const userAlleleData = snp.allAlleles[userAlleleKey] || {};
            
            const scoreTranslations = {
                'excellent': 'V√Ωborn√Ω',
                'good': 'Dobr√Ω',
                'average': 'Pr≈Ømƒõrn√Ω',
                'risk': 'Riziko',
                'poor': 'Slab√Ω',
                'caution': 'Pozor',
                'neutral': 'Neutr√°ln√≠'
            };

            // Determine user score color
            let colorClass = 'border-slate-600 bg-slate-800/50 text-slate-400';
            const score = userAlleleData.score || 'neutral';
            
            if (score === 'excellent' || score === 'good') {
                colorClass = 'border-emerald-500/50 bg-emerald-500/10 text-emerald-400';
            } else if (score === 'average') {
                colorClass = 'border-amber-500/50 bg-amber-500/10 text-amber-400';
            } else if (['poor', 'risk', 'caution'].includes(score)) {
                colorClass = 'border-red-500/50 bg-red-500/10 text-red-400';
            }

            // Other variants logic for single mode
            const otherVariantsHtml = !isCompact ? Object.keys(snp.allAlleles)
                .filter(key => key !== userAlleleKey)
                .map(key => {
                    const allele = snp.allAlleles[key];
                    const alleleScoreLabel = scoreTranslations[allele.score] || allele.score;
                    
                    return `
                        <div class="flex flex-col gap-1 text-xs text-slate-500 bg-slate-800/50 px-3 py-2 rounded border border-slate-700/50 w-full">
                            <div class="flex items-center justify-between">
                                <span class="font-mono font-bold text-slate-300 text-sm">${key}</span>
                                <span class="text-[10px] uppercase tracking-wider opacity-70">${alleleScoreLabel}</span>
                            </div>
                            ${allele.description ? `<div class="text-xs leading-relaxed opacity-80 text-slate-400 mt-1">${allele.description}</div>` : ''}
                        </div>
                    `;
                }).join('') : '';

            // Removed fixed height constraint as per user request
            const descClass = '';

            return `
                <div class="snp-container mb-4 last:mb-0 flex flex-col h-full">
                    <!-- Header -->
                    <div class="snp-meta border-b border-slate-700 pb-2 mb-3 h-[32px] flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <span class="gene-badge text-xs font-bold px-2 py-1 rounded bg-slate-700 text-slate-200 w-[80px] text-center">${snp.gene}</span>
                            <a href="https://www.ncbi.nlm.nih.gov/snp/${snp.rsid}" target="_blank" class="font-mono text-slate-500 hover:text-emerald-400 text-sm truncate">${snp.rsid}</a>
                        </div>
                        ${snp.isReverseComplement ? `
                            <div class="group relative inline-flex">
                                <span class="cursor-help text-[10px] font-bold tracking-wide text-slate-400 bg-slate-800/50 border border-slate-700 px-1.5 py-0.5 rounded hover:bg-slate-700/80 hover:border-slate-600 transition-all select-none">üîÑ RC</span>
                                <div class="opacity-0 invisible group-hover:opacity-100 group-hover:visible absolute right-0 top-full mt-2 w-64 p-3 bg-slate-800 text-xs text-slate-300 rounded-lg border border-slate-600 shadow-xl z-[100] text-left transition-all duration-200">
                                    <strong class="text-emerald-400 block mb-1">Reverse Complement (RC)</strong>
                                    Va≈°e data jsou z opaƒçn√©ho vl√°kna DNA ne≈æ datab√°ze. Aplikace je automaticky otoƒçila (A‚ÜîT, C‚ÜîG) pro spr√°vn√© vyhodnocen√≠.
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Main Result (Prominent) -->
                    <div class="flex flex-col sm:flex-row gap-4 items-start mb-4 flex-1">
                        <div class="flex-shrink-0 text-center">
                            <div class="w-16 h-16 flex items-center justify-center rounded-xl border-2 ${colorClass} shadow-sm mb-2">
                                <span class="text-2xl font-bold">${userAlleleKey}</span>
                            </div>
                            <div class="text-xs font-bold uppercase tracking-wider ${colorClass.split(' ').pop()}">
                                ${scoreTranslations[score]}
                            </div>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-slate-200 mb-1">${userLabel}</h4>
                            <p class="text-slate-400 leading-relaxed text-sm ${descClass}">
                                ${snp.description || 'Bez popisu.'}
                            </p>
                        </div>
                    </div>

                    <!-- Other Variants - ONLY IN SINGLE MODE -->
                    ${!isCompact && otherVariantsHtml ? `
                    <div class="mt-4 pt-4 border-t border-slate-800/50">
                        <span class="text-xs uppercase tracking-wider text-slate-600 font-semibold mb-3 block">Ostatn√≠ mo≈æn√© varianty:</span>
                        <div class="flex flex-col gap-2">
                            ${otherVariantsHtml}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function createSnpsHtml(snps, userLabel = "V√°≈° v√Ωsledek", isCompact = false) {
            if (!snps) return '';
            return snps.map(snp => renderSnpCard(snp, userLabel, isCompact)).join('');
        }

        // =====================================================
        // INIT & EVENT LISTENERS
        // =====================================================
        document.getElementById('mobile-menu-toggle').onclick = () => {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        };

        // File inputs
        ['file-input-db', 'file-input'].forEach(id => {
            document.getElementById(id).onchange = (e) => {
                if (e.target.files[0]) id.includes('db') ? handleDbFile(e.target.files[0]) : handleCsvFile(e.target.files[0]);
            };
        });

        // Comparison Upload
        const compZone = document.getElementById('comparison-drop-zone');
        const compInput = document.getElementById('file-input-comparison');
        
        if (compZone && compInput) {
            compZone.onclick = () => compInput.click();
            
            compZone.ondragover = (e) => {
                e.preventDefault();
                compZone.classList.add('border-emerald-500', 'bg-slate-800');
            };
            
            compZone.ondragleave = () => {
                compZone.classList.remove('border-emerald-500', 'bg-slate-800');
            };
            
            compZone.ondrop = (e) => {
                e.preventDefault();
                compZone.classList.remove('border-emerald-500', 'bg-slate-800');
                if (e.dataTransfer.files[0]) handleCsvFile(e.dataTransfer.files[0], true);
            };

            compInput.onchange = (e) => {
                if (e.target.files[0]) handleCsvFile(e.target.files[0], true);
            };
        }
        
        ['drop-zone-db', 'drop-zone'].forEach(id => {
            const el = document.getElementById(id);
            el.onclick = () => document.getElementById(id.replace('drop-zone', 'file-input')).click();
            el.ondragover = (e) => { e.preventDefault(); el.classList.add('drag-over'); };
            el.ondragleave = () => el.classList.remove('drag-over');
            el.ondrop = (e) => {
                e.preventDefault();
                el.classList.remove('drag-over');
                if(e.dataTransfer.files[0]) id.includes('db') ? handleDbFile(e.dataTransfer.files[0]) : handleCsvFile(e.dataTransfer.files[0]);
            };
        });

        // ScrollSpy
        function initScrollSpy() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        
                        // Clear all active states
                        document.querySelectorAll('.menu-item, .sub-menu-item').forEach(el => el.classList.remove('active'));

                        if (id.startsWith('category-')) {
                            // Activate category menu item
                            const catId = id.replace('category-', '');
                            // Find the menu item that calls scrollToId('category-catId')
                            const menuItems = document.querySelectorAll('.menu-item');
                            menuItems.forEach(item => {
                                if (item.getAttribute('onclick')?.includes(catId)) {
                                    item.classList.add('active');
                                }
                            });
                        } else if (id.startsWith('trait-')) {
                            // Activate trait sub-menu item
                            const parts = id.split('-'); // trait-nutrition-fat_burning
                            if (parts.length >= 3) {
                                const catId = parts[1];
                                const traitId = parts.slice(2).join('-');
                                
                                // Activate parent category
                                const menuItems = document.querySelectorAll('.menu-item');
                                menuItems.forEach(item => {
                                    if (item.getAttribute('onclick')?.includes(catId)) {
                                        item.classList.add('active');
                                    }
                                });

                                // Activate specific trait item
                                const subItems = document.querySelectorAll('.sub-menu-item');
                                subItems.forEach(item => {
                                    if (item.getAttribute('onclick')?.includes(traitId)) {
                                        item.classList.add('active');
                                    }
                                });
                            }
                        }
                    }
                });
            }, { rootMargin: '-10% 0px -80% 0px' });
            
            document.querySelectorAll('.category-section, .trait-card').forEach(el => observer.observe(el));
        }

        // =====================================================
        // EXPORT
        // =====================================================
        async function exportPDF() {
            const resultsContainer = document.getElementById('results-container');
            const statsBar = document.querySelector('.stats-bar');
            const button = document.getElementById('export-pdf-btn');
            const compWrapper = document.getElementById('comparison-container');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (!resultsContainer) return;

            // Show loading state
            const originalButtonText = button.innerHTML;
            button.innerHTML = '<span class="animate-spin">‚è≥</span> Generuji screenshot...';
            button.disabled = true;

            // Store original styles
            const originalStyles = {
                sidebarDisplay: sidebar.style.display,
                mainMargin: mainContent.style.marginLeft,
                mainOverflow: mainContent.style.overflow,
                mainHeight: mainContent.style.height,
                statsPosition: statsBar.style.position,
                bodyBg: document.body.style.background
            };

            try {
                // 1. Prepare layout for screenshot
                sidebar.style.display = 'none';
                mainContent.style.marginLeft = '0';
                mainContent.style.overflow = 'visible';
                mainContent.style.height = 'auto';
                statsBar.style.position = 'static';
                compWrapper.style.display = 'none';
                button.closest('div').style.display = 'none';
                
                // 2. Create wrapper with title
                const screenshotWrapper = document.createElement('div');
                screenshotWrapper.id = 'screenshot-wrapper';
                screenshotWrapper.style.cssText = `
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 1200px;
                    background: linear-gradient(135deg, #0a0118 0%, #1a0b2e 25%, #16213e 50%, #0f3460 75%, #1a1a2e 100%);
                    color: #e2e8f0;
                    padding: 40px;
                    font-family: 'Inter', sans-serif;
                    z-index: 9999;
                `;
                
                // Add title
                const title = document.createElement('div');
                title.style.cssText = `
                    text-align: center;
                    margin-bottom: 40px;
                    padding-bottom: 30px;
                    border-bottom: 2px solid #334155;
                `;
                title.innerHTML = `
                    <div style="font-size: 64px; margin-bottom: 15px;">üß¨</div>
                    <h1 style="font-size: 42px; font-weight: bold; color: #f1f5f9; margin-bottom: 15px;">MyDNA Report</h1>
                    <p style="color: #94a3b8; font-size: 18px;">Vygenerov√°no: ${new Date().toLocaleDateString('cs-CZ')}</p>
                `;
                screenshotWrapper.appendChild(title);
                
                // Clone stats (without buttons)
                const statsClone = statsBar.cloneNode(true);
                const cloneCompWrapper = statsClone.querySelector('#comparison-container');
                const cloneBtnWrapper = statsClone.querySelector('#export-pdf-btn')?.closest('div');
                if (cloneCompWrapper) cloneCompWrapper.remove();
                if (cloneBtnWrapper) cloneBtnWrapper.remove();
                statsClone.style.marginBottom = '40px';
                screenshotWrapper.appendChild(statsClone);
                
                // Clone results content
                const contentClone = resultsContainer.cloneNode(true);
                screenshotWrapper.appendChild(contentClone);
                
                // Insert into body
                document.body.appendChild(screenshotWrapper);
                
                // Wait for render
                await new Promise(r => setTimeout(r, 500));
                
                // 3. Capture with html2canvas
                const canvas = await html2canvas(screenshotWrapper, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#0a0118',
                    width: screenshotWrapper.scrollWidth,
                    height: screenshotWrapper.scrollHeight,
                    windowWidth: screenshotWrapper.scrollWidth,
                    windowHeight: screenshotWrapper.scrollHeight,
                    x: 0,
                    y: 0
                });
                
                // 4. Download as PNG
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.download = `MyDNA_Report_${new Date().toISOString().split('T')[0]}.png`;
                    link.href = url;
                    link.click();
                    URL.revokeObjectURL(url);
                });
                
                // 5. Cleanup
                document.body.removeChild(screenshotWrapper);

            } catch (err) {
                console.error('Screenshot Error:', err);
                alert('Nepoda≈ôilo se vytvo≈ôit screenshot: ' + err.message);
            } finally {
                // 6. Restore all original styles
                sidebar.style.display = originalStyles.sidebarDisplay;
                mainContent.style.marginLeft = originalStyles.mainMargin;
                mainContent.style.overflow = originalStyles.mainOverflow;
                mainContent.style.height = originalStyles.mainHeight;
                statsBar.style.position = originalStyles.statsPosition;
                compWrapper.style.display = '';
                button.closest('div').style.display = '';
                
                button.innerHTML = originalButtonText;
                button.disabled = false;
            }
        }

        // Start
        loadDatabaseFromGitHub();

    </script>
</body>
</html>

